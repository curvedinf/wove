============================= test session starts ==============================
platform linux -- Python 3.12.5, pytest-8.4.0, pluggy-1.6.0
rootdir: /home/chase/Projects/wove
configfile: setup.cfg
plugins: cov-6.2.1, anyio-4.9.0, asyncio-1.1.0, django-4.11.1
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 7 items

tests/test_core.py .....F.                                               [100%]

=================================== FAILURES ===================================
_______________________ test_error_cancels_running_tasks _______________________

    @pytest.mark.asyncio
    async def test_error_cancels_running_tasks():
        """
        Tests that an exception in one task cancels other concurrently running tasks.
        """
        long_task_started = asyncio.Event()
        long_task_was_cancelled = False
        with pytest.raises(ValueError, match="Failing task"):
            async with weave() as w:
                @w.do
                async def long_running_task():
                    nonlocal long_task_was_cancelled
                    long_task_started.set()
                    try:
                        await asyncio.sleep(0.2)  # Long enough to get cancelled
                    except asyncio.CancelledError:
                        long_task_was_cancelled = True
                        raise
                    return "should not finish"
    
                @w.do
                async def failing_task():
                    await long_task_started.wait()
                    raise ValueError("Failing task")
    
>       assert long_task_was_cancelled, "The long-running task should have been cancelled"
E       AssertionError: The long-running task should have been cancelled
E       assert False

tests/test_core.py:163: AssertionError
=========================== short test summary info ============================
FAILED tests/test_core.py::test_error_cancels_running_tasks - AssertionError:...
========================= 1 failed, 6 passed in 0.20s ==========================
